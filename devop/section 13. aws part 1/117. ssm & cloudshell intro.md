# SSM & CLOUDSHELL INTRO

Hello and welcome.

In this lecture we are going to talk about a service called `AWS Systems Manager` and also `CloudShell`.

These are pretty easy to use services and comes very handy.

`AWS Systems Manager` is very powerful. You can manage many nodes at scale when it comes to operations or system administration. One very simple use case is you can directly SSH or get a session to your EC2 instance from here without using any tools. That's what we are going to see.

And one more thing. You can run your commands on a node or a group of nodes at one time. Imagine you are managing hundreds of EC2 instances, and you need to execute one command on your hundreds of instances, like restarting a service or running a patch. In that case, AWS Systems Manager comes very handy.

You can use the run command feature of Systems Manager and execute commands on multiple machines at one time. So let's see some example.

First we are going to launch an EC2 instance and see how we can access it through AWS Systems Manager.


- So create an EC2 instance called `server1`. 

- Select Ubuntu server 24 free tier eligible. Instance type t2.micro or t3.micro, whichever comes in the free tier. 

- Login key, you can select the existing key or create a new key, it doesn't matter because we are not going to use key to login. We are going to do it through SSM.

- Security group, also, select the existing security group.

- Launch the instance.

So EC2 instance needs some permission to connect to SSM. And that permission can be managed by IAM. So let's go to `IAM` service.

So we have already seen how we can create user and assign permission to the user. But what if one service wants to connect to another service? So `EC2` wants to connect to `SSM`. In that case we use `Roles`.

So click on `Roles -> Create Role`. Select for what you want to create this role I want to do it for `AWS service`. `Use case` is going to be the `EC2` and then go `Next`.

Now here you select the policy permission, you need to look for this policy `AmazonSSMManagedInstanceCore`, then click `Next`. 

Now you need to give `Role` a `Name`, you can give anything, I'm keeping it as `SSMManagedInstanceCore` and same for the `Description`. And let's scroll down and click `Create role`.

So the role is created. Now it's time to attach this role to our instance. So let's go back to our instance and go to `Actions -> Security -> Modify IAM role`, select your role and click on `Update IAM role`.

Now let's see how we can access the EC2 instance from the SSM. Go to `AWS Systems Manager` service and go to `Session Manager`, click on `Start session`.

Now it might take some time for the instance to show up over here. So if it doesn't show your instance cancel it. Wait for some time. Also check if your IAM role is correctly attached and then you can try again.

You can give some reason over here. I have given `shellAccess`. Select your instance and then click `Next -> Next -> Start session`.

Once you click on `Start session`, it should open a new tab and you will get a session, and once you get it, you can execute your commands like 

```
# switch to root user
$ sudo -i

# check OS info
$ cat /etc/os-release
```
You can do all the activity that you want. So this way you don't need to manually connect or do SSH session that we do from git bash or the terminal.You don't need keys. You don't need to work on the security groups.

So you can have an IAM role ready as soon as you launch the instance. You make sure you attach that IAM role and then you can connect it like this.

Okay, I'm closing the session now. And let's go back to `AWS Systems Manager`. Now that we've got the shell access, if you want to run a command on one or many node you can go to this option `Run Command -> Run command`

Now you will see a list. These are the commands. Or here it's called as the command document that you want to execute. Most of them won't make any sense for now. Once you learn Ansible you can understand Ansible playbook. When you learn CloudWatch and Docker and other services, then these things can start making sense.

Right now we just want to run a command. And for that the document name is `AWS-RunShellScript`.

So search with that name and you can select that document `AWS-RunShellScript`.

Scroll down, and here in the `Command parameter` you can mention your command e.g

```
$ ls -l /var/log/

$ free -m

$ sudo apt update
```

just the list of command that you want to execute, or your entire shell script over here. 

And then you can scroll down, you can mention the `Working directory` where you want to run this. You can give the instance tag i.e `Specify instance tag`, let's say you want to execute something on instances with tag `Project`: `DevOps`, you need to make sure that all the instances are tagged like that properly with this tag, and then you can give the tag and its value and it will execute it on the instances that has this tag. It could be one or many. If you have created a resource group, then you can select `Choose resource group` and then you can select from the group which will be the group of instances, or you can just execute it manually, select `Choose instance manually`, you can select then your instances from the list. So we just have one instance. So I'm going to select this instance. Or if you have the list you can select from the list.

There are a few other options like storing it into an `S3 bucket`, disable that for now, once you learn S3 you will understand that and also storing the output into CloudWatch logs, disable that as well, we are going to cover that later.

Once you learn these services, you'll understand these options. Once you select your instance, mention your command. You can click `Run`.

Now here you see the status. It's `In progress`. You see the instance ID. Let me refresh this okay. It says `Success`. It's already done. So you can select your instance and see the command output. So the output will come in the `Output` section. And any error that comes will be coming into the `Error` section.

So like that you can manage also group of instances. Many instances you can have complete control or a centralized control.

There are many other options that comes with SSM. 

- You have `Compliance`, 

- `Change management` very essential for system administrators, 

- You can store variables over here like `Parameter store`. We're going to do that in some project later.

- You have `CloudWatch`.

- You have `Operations center`

- `Incident management` and many other things.

So basically this is an amazing tool for system administrator or operations to manage the entire operation of your fleet of servers.

One other thing I want to show you over here is AWS `CloudShell`, you find it at the bottom left of the AWS console.

We have seen in AWS CLI, if you want to execute AWS commands, first we need to install `awscli`, and then we need to set up the access key. And then we can execute the command. 

With CloudShell, you can do it all from here. You will be logged in with your user account permission. So I've logged in with the root account.

And I'm going to show you I can run commands over here like 

```
$ aws ec2 describe-instances
```

So we did not set any access key, we did not installed awscli, everything comes by default with the CloudShell.

```
# list your S3 buckets
$ aws S3 ls
```

You're going to learn S3 later on.

And totally you can manage your entire AWS account from the CloudShell, and if you need access to any commands you don't know, then you can open the Amazon Q Developer Chat, you can ask the question over there., you get the command and you can execute it on the cloud shell.

So everything at one place, you can open the CloudShell into a separate tab also.

So in one AWS cloud login you get here CloudShell, Systems Manager, Amazon Q developer as an AI assistant. So you can manage everything from the browser.

Now which to use when totally depends on your requirement. I have used all of them for different requirement and use cases.

The point is, as a DevOps, you should know about these tools so you can use them whenever it's required.

So feel free to explore. Once you are done, then delete your EC2 instance.

Wrap this up and then join me in the next session.





