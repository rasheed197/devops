# AWS CLI

Hello and welcome.

In this lecture we are going to look at `Amazon CLI` or command line interface. And we're also going to see how to use `Amazon Q` which is the Amazon AI assistant used in coding. We can use it to get information via chatting. And there are a few other amazing benefits of Amazon Q.

First, let's talk about the Amazon CLI.

So everything we do on AWS through the browser through Amazon console, like so far we launched instance, we created key pair etc.. All those things can be also done from the command line interface by issuing commands.

We can do it from our own computer, be it windows, Mac OS or Linux or any other place where we have the command line interface installed. First we need to install `aws cli`. To install it on windows we have the command `choco install aws cli`.

`Windows`

Open Powershell as admin user and execute below command
```
$ choco install awscli -y
```

`MacOS`

Open Terminal and execute below command

```
$ brew install awscli
```

`Linux`

Open Terminal and execute below commands

```
$ curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"

$ unzip awscliv2.zip

$ sudo ./aws/install
```

I'm using Windows so I'm going to open PowerShell as admin user. Execute the command `choco install awscli -y`.

`awscli` is installed for me. I'm going to close PowerShell.

Now we need to set authentication. When we open the browser and go to Amazon Console, we authenticate with username and password. From command line, we need to do it through the access keys.

Access keys comes with the `IAM` user. So go to your AWS console look for the service `IAM`, click on it, go to `Users`, click on `Create user`. Give user a name, I'm giving `cliadmin`,  click `Next`.

Now we need to give some permission privilege to this user so we can use different services.

So we click on `Attach policies directly`. IAM has many ready made policies that you can attach to a user. For example, if you search for `ec2` we have something like `AmazonEC2FullAccess` which gives the user complete access on EC2 service but not on other services. But then you can fine tune these policies also, you can have read only access or based on what service you want to use.

Now for this lecture we are going to use multiple services. So we are giving `Administrator access`, the click `Next` -> `Create user`.

Now be very very careful with this one, you cannot lose credentials for this user. You cannot expose it to anybody, anywhere because if that happens, then that other party is going to get complete access on your AWS account. So be careful.

I'm giving administrator access now. So far there are no access we are giving to this user. Just creating the user. There's no credential. There's no nothing attached to this user. 

Now we click on this user. You will see we have administrator access. We go to `Security credentials`. So we are not giving any console access to this user. We scroll down we see here `Access keys`. Now this is for as it says; Use access keys to send programmatic calls to AWS from the AWS CLI, AWS Tools for PowerShell, AWS SDKs, or direct AWS API calls. You can have a maximum of two access keys (active or inactive) at a time.

So click on `Create Access key`. Select your use case, select `Command Line Interface (CLI)`. Scroll down and click `I understand the above recommendation ...` and click `Next -> Create access key`.

So this is two parts. You have the 

- `Access key` and you have the 

- `Secret access key`.

So it works like you know username and password that we have seen but not actually username and password. And you see the secret access key one time and then it will be gone.

So you can download it all into a CSV file. So click on `Download .csv file`. So mine got downloaded into `Downloads` folder and then click `Done`.

So here in the `Access keys` you can see the access keys, but you cannot see the secret access key over here. That's gone. It's downloaded in my downloads folder so I can open it and set it up. But before we go there, just take a look at the `Actions`. You can `Deactivate` an access key. You can `Delete` the access key and one user can have multiple access keys. You can create multiple access keys. And you can select which one to activate, which one to deactivate.

Now always be very cautious. Extra cautious when it comes to the access keys. These are text and there are many instances where people post it on GitHub. Public repositories, public places where there are bots that can scan these keys, get the keys, and will start doing crypto mining in your AWS account. You'll have many instances and you will have huge bills within a few hours.

So be very, very careful with these keys. Do not lose them. Do not put them into public places. Do not show it to anybody. Now let's set these keys.

So you must have downloaded the CSV file. Open it in notepad. You can see the access key and secret key over there, they are comma separated.

If you're using Windows Open Git Bash. If you're using MacOS or Linux, open the terminal and run the command 

```
$ aws configure
```

This will ask you the access key. Paste it over there. Then get the secret key.

Mention the region. This will be the default region. We can change it whenever we want. So I'm going to use `us-east-1`. So make sure the region code is correct, you can check it from your console. So I'm using North Virginia and its code is `us-east-1`.

Then the default output format, we are going to keep it as `json` format.

Now this informationis going create a folder in your ome directory `.aws` and this folder is going to contain two files `config` and `credentials` file.

```
$ ls ~/.aws/
```

`config` file will have the region and the output format

```
$ cat ~/.aws/config
```

and `credentials` file will have the access key and secret key.

```
$ cat ~/.aws/credentials
```

So if you make a mistake you can manually also go to editors like `vim` and open it and make the changes. Or you can just run the `$ aws configure` command once again and give your entries.

Usually we make mistake while doing copy, pasting or typing, and the awscli does not work. 

So like for example, now I'm going to run a command which should return me information about the account id, user id. 

```
$ aws sts get-caller-identity
```

If all the information that I have given is correct, this command should work, but if you get any error then you better run `$ aws configure` command once again and set the details again.

If it's working, let's run our first command to get information about the EC2 instances.

```
$ aws ec2 describe-instances
```

So it's going to describe all the instances in the current region, which is us-east-1. And the output will be in the JSON format. It'll open in the `more` editor, you can hit `Enter` to see more details.

You can see `Architecture` type, `DeviceName`, `Volume_Id`, `Public_Ip`, `InstanceType` t2.micro 

You can keep hitting `Enter` until you come till the end. Or you can just hit `Q `to quit it.

Okay, now there are many AWS services and there are many, many settings. So as I told you, we can do everything through command line, but it's impossible to remember these commands. You should not even remember the commands. That will be a stupid idea. So usually I used to show documentation like `awscli documentation`. You go to `User guide`. You can see all the information over there.

So sure you can go through the documentation and find out information. Create your command and execute it. Or you can use the AI tools like ChatGPT, which is great, but AWS also has its own AI called `Amazon Q`. That's what we are going to use.

You look at the icon over at the top right. You should see it `Amazon Q` you click on it and you can start chatting. We're going to see Amazon Q later. Also as a code assistant in our VS code we're going to write codes later, scripting, automation code. It's like GitHub Copilot. Also you can use like a code assistant agent AI.

But right now we're just going to use it as a chatting tool like ChatGPT and we can get information from it like how to do any tasks.

For example, `How to create key pair using awscli`.

Now Amazon EC2 is slower than other AI tools like ChatGPT for chatting, but it is the most precise one that I have seen so far.

And for this such simple thing, of course ChatGPT will also give you the right thing. But when we get into detail later in this course, when we do scripting, when we programmatically create AWS resources, that time you will see the power of `Amazon Q`. Now anyways, so we get the command, copy it and try it.

Now next command let's ask create security group.

`Create security group with name mysg with rule 22 from my IP and 80 from anywhere`.

I'm just being very simple. No prompt modification or refining the prompt. Nothing. Just plain chatting. Just keeping it as simple as I can and see if it gives me the right information or not.

Last command I'm going to ask 

```
Launch EC2 instance with below details 
name: web02
key pair: MyKeyPair
security group: mysg
AMI: [AMI ID]
Instance type: t2.micro
```

So I gave it MyKeyPair which we created previously.

For the AMI I gave the `[AMI ID]` which is the best way to do it, but you can also give the name e.g `Amazon Linux AMI`. It can find the `[AMI ID]` for you based on the region also, but I want it to be very specific okay.

Let's hit enter and let's see the command that it gives us. Let's copy and run the command.

Now let's take a look in the Amazon console. So we have `web02` here, in the `Security` tab, you can see the `Security group`, you can see the rules in the security group you can see the key pair name.

Now why do we need this command line, where will we use it? 

You are going to see that in the upcoming lectures, when we do DevOps CICD pipelines, when we do programmatic access, there are situations where we need the command lines. I'm not asking you to know, memorize or learn all the commands.

No, but you should have the power of CLI in your hand for whenever you need it, and trust me, you will need it.

So you have documentation, you have Amazon Q, you have ChatGPT you can use all these resources and find the command and execute it. Just don't run it blindly.

Take a look see what command is saying and test it before you use it into your scripting, which we'll see later.

Once you're done, you can delete the instance web02, and make sure you deactivate the access keys that you have created.

Now that you can use the command line better, use the command line, find out the command to terminate this instance. 

Then go to IAM, you can either delete the user or delete the access key. Or before you do that, play with AWS a little bit more. See what you can do, just get to know it a little bit better.

You really don't need to master it, but just some hands on which will be very useful in our further lectures.

Okay then that would be all in this lecture. I will see you in the next one.


