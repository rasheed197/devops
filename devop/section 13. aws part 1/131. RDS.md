# RDS

Welcome to the `RDS` session, `Relational DataBase Service` from AWS.

This service really solves your database administration problems. So there are a lot of things that goes into database administration.

1. `Installs`: setting up the database itself.

2. `Regular patchings`

3. `Monitoring`: continuous monitoring of your DB servers

4. `Performance tuning`

5. `Backups`: regular backups we need to take. So in an event of failure we can roll back, which is very, very important for databases, because if you lose the data, if you lose the client or customer data, it is extremely bad for the business. So regular backups needs to be done.

6. `Scaling`: We need to be also scaling based on the requirement. If business growing, we add more databases, servers. So scaling out, which is really difficult in SQL databases.

7. `Security`: we need to make sure it's always secure. Otherwise you hear a lot of stories every now and then that some website data was put on the Black Market.

8. `Hardware upgrades`: hardware upgrades needs to be done.

9. `Storage Management`: you need to also scale the storage as well based on the requirement. 

So there a lot of things in database administration you need to do. AWS RDS service will do most of it for you, automatically. 

## RDS

1. So RDS or Amazon Relational DataBase service is a distributed Relational Database service. 

2. You can have high availability in multiple availability zones. 
    So while you're creating an RDS instance, you can decide you want Multi-AZ and that will give you a primary database and a secondary database. If primary fails, the secondary will take its place. That's Multi-AZ in RDS.

3. Very easy to scale.

4. There are read replicas to improve the performance.

So Multi-AZ is for high availability, but read replica is for performance. Like in Multi-AZ you have primary and secondary, and when the secondary becomes primary, it will also start taking the WriteRequest. But read replica will be the replica of your primary and the data will be continuously syncing. You get an endpoint and developer can mention in their code that the read request goes to the read replica instead of going to the main primary database. Which improves the performance drastically because most of the request on the DB will be read most of the application.

A very common use cases in within your VPC, within your AWS network, you create RDS, you can see a privately accessible RDS and that can be only accessed by any to instance in the same VPC. And let's say that web EC2 instance is running a web service which can be accessed from the internet. So user accessing the website from the internet and the EC2 instance will be accessing RDS privately.

This is one very common use case of RDS. It's really very easy to get started with RDS. So let's get started.

Okay, so come to AWS console and search for `RDS`, and click on RDS Service. Okay, so this is the dashboard we need to first create the RDS instance. So we can click over here on the `Databases` or we can click over here at the `DB Instances`. So click on the button which says Create Database. Okay, so we have a `Standard create` option over here and `Easy create`, if you quickly want to create RDS instance, you can click on `Easy create`, but I'll keep it as `Standard create` so we can see all the option that RDS provides us.

Okay, first comes the `Engine` options.

So we have different types of engines. So like we have MySQL, PostgreSQL, MariaDB or Oracle Database, Microsoft SQ Server and IBM Db2, that's the new one.

So based on your requirement, your project demands, you need to select that particular engine. So we'll be going with MySQL, but I want to also talk about `Aurora`.

`Aurora`, you have two option, you can create `MySQL` Aurora or `PostgreSQL` style Aurora. So if you already know MySQL and or PostgreSQL and if you want to, let's say you want to create MySQL or PostgreSQL, you can go with Aurora.

The benefit that you get is Aurora is faster and cheaper compared to MySQL and PostgreSQL option that you select over here. Now this is created by AWS, this particular service, it's separate service, you'll find it only on AWS. So if you check documentation of Aurora, you see it claims a 1/10th of the cost of commercial databases and Aurora has five times more throughput of MySQL and three times more of PostgreSQL because you don't need to worry about licensing and all those things. Also scaling databases or SQL databases is a big challenge and that Aurora does it very easily. You know, it has a concept of Amazon Aurora Serverless also.

Okay, so back to our creation of the RDS instance. We'll go with MySQL where you have here free tier MySQL and MariaDB, in Aurora you don't have any free tier options. So if you're going to create it, that's going to be of some charge, you know, some charger will be there. So let's go with MySQL just for learning purpose

and let's come down. So next we have `Engine version`. So we selected MySQL. So which version of MySQL do you want. So it has the 8 until the 5.7, because 5.7 is also very used still. So we'll keep it the default one 8.0.39.

Okay? Then we have the templates. Now templates basically just depends on what settings you're going to select. So you have `Production`, `Dev/Test` and `Free tier`.

Now for first time and just to be sure, make sure you select `Free tier`. I'm going to keep it at `Dev/Test` because I need to show you a lot of options, because accidentally if you select any other expensive service of RDS then it should be a problem, right? So let's keep free tier for you. I'm going to select Dev/Test.

Now difference between `Production` and `Dev/Test` is this, productions gives you multi zones. You'll have multiple RDS instance like we discussed previously, distributed in multiple zones and the storage will be also faster, throughput optimized, you know, high IOPS. So you know, this will not be free. Production will definitely be not free. Dev/Test, we can select free option from this. So we can select, you know, Single Instance and normal storage, general purpose, gp2, gp3, like that. So I'm going to keep Dev/Test.

So in `Availability and durability`, you have first `Multi AZ DB Cluster`, Now in the cluster you have a primary instance and two readable standby DB instance. So there will be two standby instance, but there will be no readable instance. So the read queries will go to the standby instances also. So it's a cluster.

The second option, `Multi AZ DB instance` where you have one primary and one standby, okay? Both in different availability zones. So if the primary goes down, then only the standby will come in. But in the cluster the standby will be also doing the reading. And then you have the `Single DB instance`. Make sure you keep it to single DB instance. Okay?

Now next comes the settings. The `DB instance identifier`. That will be just the name of your RDS instance. So I will name it as `vprofileMySQLServer`. That is just the name of the RDS instance.

Okay, login details, `Credential settings`. So username `admin` by default. If you wish, you can change this one. I'm going to keep it as admin. And then the password, how do you want to manage the password? One option is to keep it in the `secrets manager more secure`, but this is not free. Okay, so the password will be kept with AWS Secret Manager Service and nobody can get access to it as long as they don't have the authentication. And you have the `self-managed` where you can mention your own password or you can use the `Auto generate password`. I'm gonna keep it as `Auto generate password`.

Okay, let's scroll down. Now comes the `Instance compute settings`. What type of instance you need? It's just like selecting an EC2 instance instance type. So you have three sections over here, `Standard classes`, `Memory optimized` and `Burstable classes`.And for a high performing database you should go

with `Memory optimized classes`, this r and x series. But we'll be going with `Burstable classes` because we want to keep it under free tier. So we'll go with `db.t3 micro`.

If you selected the template as free tier, it's going to automatically select the free type instance, so you don't need to worry about this. But if you select a `Dev/Test`, make sure you select your `db.t3 micro`.

Next comes the storage. Now `Storage type`, we'll go with gp3. We can go with `gp2` also, but `IOPS`, `Provisioned iOPS SSD`, this is not going to be free, but it's going to be high performing for realtime production databases, very much required. Another `magnetic`, but that will be only, you know, when you want to keep your instances, you know, standby, you don't want to use it in real time, then you can go with magnetic. It's not for real time use case, just to you know, keep it in standby mode.

So we'll keep `gp3` and we'll select the storage as `20` GB only because that's the minimum we can do.

Okay, `Additional storage configuration`. If you want to enable auto scaling, you can go with this, but really we are not going to scale our database cause there's no load coming, but there is an option of automatically scaling the storage. So you can keep this on or off does not matter because anyways, we are not going to hit any load on this one and you can select the maximum threshold maximum, how much it can go.

Okay, next comes the option of `Connectivity`. Now this is for people who do not understand security group and you know EC2 instances and stuff in details for developer. If you want to connect this instance through an EC2 instance. So you select this option, basically what this does is you select an EC2 instance, then it's going to take the EC2 security group and put it into the RDS security group. There will be an entry created in the RDS security group that allow connection from this instance. We'll do it ourself manually. So we don't need to do this. We'll create an instance and we'll see how we can access it.

Okay? Then you have the `DB subnet group`. This option you will only understand if you know the VPC, which we'll do in AWS part two. When we understand VPC, we'll understand the subnet and we'll talk about how you group the subnets together for now, just keep it as default 

And `Public accessibility`, we are going to select it as `No`, you don't want your database to be accessible publicly. You know, most of the time you will have an EC2 instance or any other service that access the RDS database privately. So we'll keep it as that and we'll see how we can access it privately also, after we create this.

`Security group`, you can select an existing security group or you can say `Create a new security group` for me. So we'll say create our own security group. We'll give it a name, I will name it as `vproMySQLRDS-sg`.

Availability zone. Which availability zone you want. We'll just say no, `No preference`, because anyways, we are creating just a single instance.

Okay, `Additional configuration`, here you have the `Port number`, default port of MySQL is `3306`. We'll keep it as it is. If you have a requirement of changing the default port of MySQL, then you better change it here. Otherwise, most of the time it is kept as default.

Okay, `Database authentication`, how do you want to authenticate to the database? We'll use the command line, MySQL command line to access it and that will be through password base. So let's keep it `Password authentication`.

Monitoring, `Enable enhanced monitoring`, for real time use cases, yes. Granularity is like almost one second. So every second also you can monitor your databaseand mind you, this will not be free, every second the database will be checked. So that is as low as the granularity of this monitoring goes, but let's not check this.

`Additional configuration`. So `Initial database name`. So you know you need to have a database name to store the, you know, table schemas and all. We'll see that when we do the project. So we'll give the database name as `accounts` and let's keep it as it is.

You have something called a `DB parameter group` and `Options group`. We'll see that once we create it. So basically advanced level of settings of the MySQL service.

Okay, now `Backup`. Do you want to have automatic backup? This in real time, you should definitely put a check mark on. So you mention the period and for that much time it's going to keep taking the database and how long do you want to keep the backup? `Backup retention period`. Like you want to keep it for 7 days or you want to keep it, you know, higher, highest option here is 35 days. So you can keep the backup for as long as you know, 35 days old. If you select seven days, any backup that is older than seven days will be deleted. That's what it means. And you can select the `Backup window`, also, when do you want to take the backups? Now we'll just uncheck this `Backup`.

`Encryption`, do you want your data to be encrypted? This is called as encryption at rest. The data that is stored in the database, do you want to keep it encrypted or not? And you have to also select the encryption decryption key also. So by default gives the option of KMS. Make sure you don't select this option. I mean in real time you select, but not now because you cannot delete the KMS keys also. You have to disable the key for, you know, it takes seven days to actually disable the key. So it's quite a hassle if you want to keep everything in free tier. So make sure you uncheck this option. In real time, you can go with this.

`Logs`, now there is no option to log into any operating system and check the logs, right? Here, the RDS instance is a platform as a service. So what about the logs that the MySQL service generates? You can stream that logs to CloudWatch servers, Amazon CloudWatch logs servers. So four types of logs that you want, you can stream to CloudWatch, you can put a check mark over there and the logs this gets generated willbe automatically stored to AWS CloudWatch logs service.

Okay, `Maintenance`, now there is an option of automatically, you know, patching the minor versions, not the major versions, the minor versions. So if you are okay with that, you can put this check mark on. Many people are not okay with this. They don't want to get the database patched automatically and that really depends on the use cases. Okay, so let's uncheck this one, you know what, let's put a check mark because you'll just create and delete it. I don't think there will be any upgrade that will come over here.

You can also select the `Maintenance window`. When do you want this to be upgraded? You can `Choose a window`. Now this gives you also one more option if you make any change to your RDS instance, you can select, do you want to do it on a maintenance window or apply it immediately? So this window is not just for the upgrade but also for yourself and you manually want to change some settings. You can select at this time apply this particular setting. You can select that option also. Let's keep it `No preference` for now. 

`Delete protection`. So this is just to prevent that someone don't accidentally delete your RDS instance.

And then over here it shows the cost `Estimated monthly cost`, the total monthly cost that you're going to bear if you selected all these things, don't worry, we are just going to create it and delete it in some time. There won't be any charges as long as you know you delete it. But if you just keep this RDS instance running for a month. For a month, this will be the charge and it is not calculating the free tier because we have a free tier account. So it's not calculating that also. So definitely it's not going to be this much also if you keep it running, but make sure after this lecture you delete this instance. Okay, so let's click on `Create Database`, and this is going to take some time to create the database, by that time we need to have an EC2 instance, so we can log into that instance and from there we are going to connect to this MySQL database, okay?

As soon as you get this popup. `Now creating the database view credential details`, click on this option and make sure you save the username and password. We'll use it when we log in from the EC2 instance. So keep it somewhere safe because once this is gone you cannot recover it. You have to reset then the password. So I'm going to keep it in my sticky notes. Okay, once you are done then you can close this one. Okay, by the time we are going to create an EC2 instance so we can connect to this RDS. So just go to `Instances`, AWS EC2 instances and say `Launch instances`, we'll launch an Ubuntu. We'll just name it as `mysqlclient`, we'll select Ubuntu OS will select or any other operating system is fine. You just need to install MySQL client over there. So let's select Ubuntu, `t2.micro`. Let's `Create a key pair`. Let's name it as `rdssqlclient`, `pem` format. `Create Key Pair`.

Okay, `Network setting` we'll say `Edit`, and we'll `Create security group`, I'll just name it as `rdssqlclient-sg`. And the rule is we need to just do the `ssh` to this instance, so allow `22` from `My IP` and that is it, just `Launch instance`.

Okay now if we go to our RDS instance, you can look at all the settings. So please take some time off yours, pause the lecture and go through all these options and check all the settings. Many settings you can change and modify. You will see the RDS `Endpoint`. You know, once it is created, available state, you can see the RDS endpoint. You can see the `Security group`. So I'm going to just open it in a different tab, that's the security group that we created, and by default has a rule 3306.Let's `Edit inbound rule`. It says `3306` allowed from `My IP`. Now this is of no use because this is a private instance. We cannot access it from the internet. So we are going to give here another rule. I'm going to `Add rule`. I will say like you can search for `mysql aurora`. Or you can just type here in the port `3306`. And we have to allow it from the RDS client security group `rdssqlclient-sg`. Description `Allow RDS client on 3306`. So our instance can access this RDS on port 3306, right? That's the security group idea of the RDS client instance security group.

So when we SSH to this instance, that we just launched, we need to connect to this RDS instance. So RDS has the security group. The security group rule will be checked 3306 allowed from the instance security group. If it says yes, then we can access it.

So let's save this rule `Save rule` and let's SSH to this instance. Let's get it's `Public IP`, I'm going to open my GIT Bash or MacOS you can just open your terminal, 

```
$ ssh -i [key path] [username]@[public ip]

$ sudo -i
```

Okay, in order to access this RDS instance from here we need to have the MySQL client because our engine type is MySQL. So we're going to run this command first

```
$ apt update
```

and then we will install the MySQL client. 

```
$ apt install mysql-client
```

the package name is mysql-client. Based on different OS and different version, you have different name of the MySQL client package. This basically gives us the MySQL command line. By using that we can access the RDS instance. 

So once it is installed, remember the package name is mysql-client in Ubuntu. Okay, so now you have to say

```
$ mysql -h [rds endpoint] -u [rds username] -p[rds password]

`-h` means the host, so go to RDS, get the endpoint, copy this and just paste it over here. And then you need to give username `-u`, `admin` is the username we used, `-p` for the password. Now I saved the password over here in sticky note, but I'm giving it here in the command line `-p` without any space, I give the password. 

Now this is just for showing purpose in real time, you should not give password like this. In the command line. You just type `-p` and hit Enter. It is going to ask you the password.

Okay, we are in, now I'm going

to say 

```
mysql> show databases;
```

And you should see a database named `accounts` over here that we created while we are launching the RDS instance.

Now, if you're not able to log in, check your username and password. If it's an authentication error, username and password, you need to check. But if it's timing out, then it's the security group problem. You need to allow the RDS security group inbound rule on port 3306 from the instance security group.

Okay now how to use it and what to do with this RDS instance that we'll see in the projects? And there are many other options with this RDS instance.

Before you delete, I recommend again you pause the lecture and go through all the settings. There are many settings that you can change and there's a `Modify` option over here where you can change the engine version. You can change the name, you can change the credential method, you can reset the password, you can change the instance type. You can change the storage, right?

So many other option it gives, you can change it to Multi-AZ also. If you're a single instance, you can switch it to Multi-AZ also. Okay security group and various other things that you can change if you wish. There are a few other settings like you know,
L you have parameter groups, subnet groups, these settings, some advanced level of settings. We're going to talk about them in the project when we set up the V profile project on AWS.

When we do rearchitecting of this project. There's many time in this course we will be using the RDS instance. So you'll have enough practice.

So once you're done with your practice over here, you know everything is good, you check all the options. If you're good, then I recommend you delete it ASAP, you know, you can just say `Action` and you can go to `Delete` button. There are other options you know, you see here, `Convert to Multi-AZ` or `Stop temporarily`, you can `Reboot` it. Reboot is usually done when you upgrade or do any patch and you have option of taking a `Snapshot`. This is basically the backup. You can see all the backups over here in the `Snapshots`. One that was manually taken, then system taken snapshots. So you won't see anything because we have disabled the automated backup. Otherwise you can see them here, the backup.

Let's go back to `RDS` and say `Action` and say `Delete`, delete the option, okay? Don't make any changes. As I told you in the projects, we are going to see many different settings of this RDS. It will ask you if you should take a final snapshot before you delete just in order to preserve your data, right? We don't need to do that because really not any production data we have over here. So make sure you uncheck this and say, I acknowledge and you had to type here, delete me and say `Delete`.

Okay so this is gonna take some time to delete, by the time, also delete your instance that we created. It's of no use for now. So `Terminate`, delete your instance. Okay make sure all this is deleted and clean.

Also later check in the snapshots in different sections. If you accidentally selected automated backup, you have to remove those backups also, right?

It's a pretty simple service and actually database is really complicated, very, you know, responsible work. But AWS has solved it.

We can create the databases and manage them very easily. We are going to see more settings and how to really actually use it in the application of project and when we set up our own project.

So that will be all in this lecture. I will see you in the next one. Thank you.


