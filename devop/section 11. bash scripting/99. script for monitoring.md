# SCRIPT FOR MONITORING

When you start a process and it's running, it'll have a `PID`, a file `[process_name].pid` will be created at `/var/run/[process_name]`, and it'll contain the pid of the process but if we stop the process, the file `[process_name].pid` will no longer exist, and the pid will be gone

To check the pid of a process, we can do

```
#start httpd process
$ systemctl start httpd

#check httpd pid
$ cat /var/run/httpd/httpd.pid

#OUTPUT
621

#stop http process
$ systemctl start httpd

#check httpd pid
$ cat /var/run/httpd/httpd.pid

#OUTPUT
cat: /var/run/httpd/httpd.pid: No such file or directory
```

We will write a script that will detect if a process is running. If it's not running it will start the process.

```
#monit.sh

#!/bin/bash

echo "#############################################"
date

#check if the file exist
ls /var/run/httpd/httpd.pid > /dev/null

#if the ls command return an exit code of 0
if [ $? -eq 0 ]
then
  echo "Httpd process is running"
else
  echo "Httpd process is NOT running"
  echo "Starting the process"
  systemctl start httpd
  if [ $? -eq 0 ]
  then
    echo "Process started successfully"
  else
    echo "Process Starting Failed, contact the admin"
  fi
fi
echo "#############################################"
echo
```

Run the file 

```
$ chmod +x monit.sh

$ ./monit.sh
```

Now that the code works fine, what we want to do is we want it to run automatically by itself let's say every minute. 

So if our process goes down for some reason, it's going to check that and start it, and it's going to do that every minute like a monitoring tool.

For that we need to schedule our script, and we're going to do it through `cron job`.

`Cron jobs` are schedule tasks

`crontab -e` is going to edit, it will open vim editor so you can add your cron job.

```
$ crontab -e
```

In the vim editor, add this
```
# MIN   HR   DOM   M   DOW   COMMAND
# 30    20   *     *   1-5   COMMAND

* * * * * /opt/scripts/monit.sh &>> /var/log/monit_httpd.log
```
Note that the `#` in the file are comments

`MIN`: Minute. * for every minute.

`HR`: Hour. 24 hour format. * for every hour.

`DOM`: Date of the month. 1 to 31. * for every date

`M`: Month. 1 to 12. 1 being january, 2 being february etc. * for every month.

`DOW`: Day of the week. 0 to 6. 0 being sunday, and 1 being monday etc. * for every day

For example set the cronjob for every night at `8:30PM`, on monday through friday

```
# MIN   HR   DOM   M   DOW   COMMAND
# 30    20   *     *   1-5   COMMAND

30 20 * * 1-5 /opt/scripts/monit.sh &>> /var/log/monit_httpd.log
```

Our script is going to generate output and we want to store it in `/var/log/monit_httpd.log`





