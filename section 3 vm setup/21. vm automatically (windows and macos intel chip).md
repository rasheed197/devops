# VM AUTOMATICALLY

## VAGRANT
- It's a tool used to manage VM automatically
- it's a VM automation tool
- it manages VM lifecycle right from 
    - creating
    - making changes 
    - cleaning up
- Vagran tool is not a replacement of any hypervisor like VMware or Oracle VM VirtualBox
- It is on top of the hypervisor
- it uses those tools to create and manage virtual machines

### VAGRANT SOLVE THE FOLLOWING VM MANAGEMENT PROBLEM
- OS Installing: Too many steps while installing OS on a VM
- Time consuming
- Manual => Human Error. Automation in general (not only vagrant) addresses this specific problem "Human Error"
- Tough to replicate multi VMs on another computer
- Need to document entire setup

## VAGRANT FOR VMs
1. No OS installation
    - vagrant set up VM machines by using VMs images or vagrant, they're called BOx
    - These are ready made VMs stored on vagrant cloud
    - They are ready made VMs stored on vagrant cloud, which will download and keep it on your local computer
    - From that box, you can create as many VM as you want

2. All the VN settings will be in a file called "Vagrantfile"
    - You cn make changes to the VM settings like RAM, CPU, IP addresses all through this vagrantfile
    - you can also do PROVISIONING with vagrant
    - Provisioning generally means wen the OS is completely booted, you want to execute some commands on it.
    - Example, when you're setting up some servers e.g web server or database server, you go through so many commandsyou can mention all thoese commands in the vagrantfile and vagrant will provision it for you.

3. Simple vagrant commands
```
# get the box name
vagrant init boxname

# list all the downloaded boxes
vagrant box list

# create or power on the VM
vagrant up

# reload the VM
vagrant reload

# check status of VM
vagrant status

# check status of all VMs
vagrant global-status

# check status of all VMs (remove old entries)
vagrant global-status --prune

# login to Linux VM
vagrant ssh

# power off the VM
vagrant halt

# delete the VM
vagrant destroy
```

## VAGRANT ARCHITECTURE
- You create the vagrantfile
- You put the VM information over there
- Run the "vagrant up" command
- vagrant is going to read the vagrantfile and sse if the box , which is the image is available in your local machine
- if it's not available in your local machine, it'll go to vagrant cloud, download the image.
- then it'll contact the hypervisor e.g Oracle VM VirtualBox, and give the information of creating the VM, and then the VM will be created.
- you can create 1 or many VMs by using vagrant

## CREATE VMs USING VAGRANT
- Open git bash
- Create a folder in your f or c drive (for Windows) or Desktop (for MacOS)
```
# Windows
mkdir /c/vagrant-vms

# MacOS
mkdir ~/Desktop/vagrant-vms
```

- navigate to that directory
```
# Windows
cd /c/vagrant-vms

# MacOS
cd ~/Desktop/vagrant-vms
```

- Create two more folders
```
# create centos folder
makdir centos

# create ubuntu folder
mkdir ubuntu
```

### CREATE CENTOS VM
- navigate to the centos folder
```
cd centos

# OR

# Windows
cd /c/vagrant-vms/centos

# MacOS
cd ~/Desktop/vagrant-vms/centos
```

- search "vagrant cloud" in google
- URL
```
https://app.vagrantup.com
```
- search "centos 9" in the vagrant website and select a box "eurolinux-vagrant/centos-stream-9"
- copy the name "eurolinux-vagrant/centos-stream-9" and run this comand in git bash
```
# in centos directory
vagrant init eurolinux-vagrant/centos-stream-9
```
- The "Vagrantfile" file will be placed in this directory. To confirm do
```
ls
```
- To view the content of the file, do
```
cat Vagrantfile
```
- Now run the command below to create and power on the VM
```
vagrant up
```
If you get an error like the one below
```
Error: schannel: next InitializeSecurityContext

Vbox hardening
```
- to fix this
    - disable your antivirus and run the command agian.
    - if you're connected to a VPN, disconnect it
    - if you're in a coporate network, you would be behind a proxy server. That'll also cause this kind of issues.

- To see the downloaded boxes
```
vagrant box list
```
- **check VM status**
    - if it's running or not
    - If you should open VirtualBox, you should see the VM.
```
vagrant status
```
- **login to the VM**
    - This will use the "ssh" command in the background, and login inside the VM
```
vagrant ssh
```
- Once you're logged in to the VM, you can run the following command
```
# get the current user
whoami

# current directory
pwd

# switch from vagrant user to root user
sudo -i

# logout from root user
exit

# logout from VM
exit
```
- **Power off the VM**
```
vagrant halt
```
- **Power on the VM**
    - the VM already exists, so it's just going to power it on.
```
# power on the VM
vagrant up
```
- **Reboot the VM**
    - When it reboots it is going to read the new changes in the Vagrantfile.
    - It will apply amy changes you made in the Vagranfile, but not the box name
    - If you change the box name, you have to delete the VM and recreate.
```
# reboot the VM
vagrant reload
```
- **Delete the VM**
    - This only deleted the VM
    - The image/box is still on our machine
    - So when you run "vagrant up" again, it will not re-download the image
    - it will use the image we downloaded previously
```
vagrant destroy
```
- See all previously executed commands
```
# see previously executed commands
history
```

### CREATE UBUNTU VM
- navigate to the ubuntu folder
```
cd ubuntu

# OR

# Windows
cd /c/vagrant-vms/ubuntu

# MacOS
cd ~/Desktop/vagrant-vms/ubuntu
```

- search "vagrant cloud" in google
- URL
```
https://app.vagrantup.com
```
- search "ubuntu jammy" in the vagrant website and select a box "ubuntu/jammy64"
- Ubuntu Jammy Jellyfish is the complete name of Ubuntu 22 Server OS
- copy the name "ubuntu/jammy64" and run this comand in git bash
```
# in ubuntu directory
vagrant init ubuntu/jammy64
```
- The "Vagrantfile" file will be placed in this directory. To confirm do
```
ls
```
- To view the content of the file, do
```
cat Vagrantfile
```
- Now run the command below to create and power on the VM
```
vagrant up
```

- The rest of the command are same as that of CENTOS
- Always power off the VM before you power off your computer


